{% extends 'base.html' %} {% block title %}Quiz{% endblock %} {% block
style_content %}
<style>
  #timer {
    z-index: 5;
    color: cornsilk;
  }
</style>
{% endblock %} {% block left_content %}
<!-- left block content -->
<div class="timer" id="timer">No time to Show</div>
<!-- <input type="hidden" name="timer_value" id="timer_value" value="{{timer_value}}"> -->
<!-- <div  name="countdown" id="countdown" value="{{countdown}}"> {{ countdown }} </div> -->

{% endblock %} {% block middle_content %}
<!-- Generate quiz -->
<div class="container" style="height: 500px; width: 600px">
  <form id="quiz-form" action="/submit/{{ index }}" method="POST">
    <!-- Other form elements -->
    <input type="hidden" id="index" value="{{ index }}" />
    <input type="hidden" name="username" value="{{username}}" />
    <input type="hidden" id="total_score" name="total_score" value="0" />
 
    {% if row_data %}
    <div id="question-container">
      {% if index > 0 %}
      <button type="button" name="prev" onclick="prevQuestion()">
        Previous
      </button>
      {% endif %}

      <h2>Question {{ index + 1 }}:</h2>
      <p id="q_font">{{ row_data[index][2] }}</p>
      <!-- Display the question -->

      <!-- Hidden input field to store the correct answer -->
      <input
        type="hidden"
        name="correct_answer"
        value="{{ row_data[index][7] }}"
      />

      <input
        type="radio"
        id="option1"
        name="answer"
        value="{{ row_data[index][3] }}"
      />
      <label for="option1" class="ans_font">{{ row_data[index][3] }}</label
      ><br />
      <!-- Display option 1 -->

      <input
        type="radio"
        id="option2"
        name="answer"
        value="{{ row_data[index][4] }}"
      />
      <label for="option2" class="ans_font">{{ row_data[index][4] }}</label
      ><br />
      <!-- Display option 2 -->

      <input
        type="radio"
        id="option3"
        name="answer"
        value="{{ row_data[index][5] }}"
      />
      <label for="option3" class="ans_font">{{ row_data[index][5] }}</label
      ><br />
      <!-- Display option 3 -->

      <input
        type="radio"
        id="option4"
        name="answer"
        value="{{ row_data[index][6] }}"
      />
      <label for="option4" class="ans_font">{{ row_data[index][6] }}</label
      ><br />
      <!-- Display option 4 -->

      {% if index < row_data|length - 1 %}
      <button type="button" name="next" onclick="nextQuestion()">Next</button>
      {% else %}
      <button type="button" name="submitQuiz" onclick="submitQuiz()"> Submit </button>
      {% endif %}
    </div>
    {% else %}
    <p>No questions available.</p>
    {% endif %}
    <!-- Hidden input field to pass the updated timer value -->
    <input
      type="hidden"
      name="timer_value_updated"
      id="timer_value_hidden"
      value="{{ timer_value }}"
    />
  </form>
</div>

<script>
  // Pass the row_data variable to JavaScript
var row_data = {{ row_data|tojson|safe }};

      // Array to store user's selected answers
var userAnswers = new Array(row_data.length).fill(null);

  // Get the initial value of index from the hidden input field
  var index = parseInt(document.getElementById("index").value);

  // Set the timer duration in seconds
  var timerDuration = parseInt(
    document.getElementById("timer_value_hidden").value
  ); // 10 minutes

// Function to update the selected answer for a question
function updateSelectedAnswer(questionIndex, selectedAnswer) {
    userAnswers[questionIndex] = selectedAnswer;
    console.log(" userAnswers"  + userAnswers)
}

// Function to calculate and update the total score
function calculateTotalScore() {
    var totalScore = 0;
    // Iterate through all questions and check user's answers
    for (var i = 0; i < row_data.length; i++) {
        var correctAnswer = row_data[i][7]; // Correct answer for the current question
        var userAnswer = userAnswers[i]; // User's selected answer for the current question
        if (userAnswer === correctAnswer) { // Check if user answered correctly
            totalScore++;
        }
    }
    document.getElementById('total_score').value = totalScore; // Update the total score input field
}

  // Function to update the countdown timer
  function updateTimer() {
    if (timerDuration >= 0) {
      var minutes = Math.floor(timerDuration / 60);
      var seconds = timerDuration % 60;
      document.getElementById("timer").innerText =
        minutes.toString().padStart(2, "0") +
        ":" +
        seconds.toString().padStart(2, "0");
      document.getElementById("timer_value_hidden").value =
        timerDuration.toString();
      timerDuration--; // Decrease timer duration by 1 second

      if (timerDuration < 0) {
        // Submit the quiz when timer reaches 00
        submitQuiz();
        clearInterval(timerInterval); // Stop the countdown
      }
    }
  }

  // Update the timer every second
  var timerInterval = setInterval(updateTimer, 1000);

  // Function to move to the next question
  function nextQuestion() {
    var selectedAnswer = document.querySelector(`input[name="answer"]:checked`);
    if (selectedAnswer) {
      updateSelectedAnswer(index, selectedAnswer.value);
    }
    if (index < row_data.length - 1) {
      index++; // Increase the question index
      displayQuestion();
    }
  }

  // Function to move to the previous question
  function prevQuestion() {
    var selectedAnswer = document.querySelector(`input[name="answer"]:checked`);
    if (selectedAnswer) {
      updateSelectedAnswer(index, selectedAnswer.value);
    }
    if (index > 0) {
      index--; // Decrease the question index
      displayQuestion();
    }
  }

  // Function to display the current question
  function displayQuestion() {
    var selectedAnswer = document.querySelector(`input[name="answer"]:checked`);
    if (selectedAnswer) {
      updateSelectedAnswer(index, selectedAnswer.value);
    }
    var questionContainer = document.getElementById("question-container");
    var questionText = row_data[index][2]; // Question text from   row_data
    questionContainer.innerHTML = `
                  ${
                    index > 0
                      ? '<button type="button" name="prev" onclick="prevQuestion()">Previous</button>'
                      : ""
                  }
                  <h2>Question ${index + 1}:</h2>
                  <p id="q_font">${questionText}</p>
                  <input type="hidden" name="correct_answer" value="${
                    row_data[index][7]
                  }">
                  <input type="radio" id="option1" name="answer" value="${
                    row_data[index][3]
                  }">
                  <label for="option1" class="ans_font">${
                    row_data[index][3]
                  }</label><br>
                  <input type="radio" id="option2" name="answer" value="${
                    row_data[index][4]
                  }">
                  <label for="option2" class="ans_font">${
                    row_data[index][4]
                  }</label><br>
                  <input type="radio" id="option3" name="answer" value="${
                    row_data[index][5]
                  }">
                  <label for="option3" class="ans_font">${
                    row_data[index][5]
                  }</label><br>
                  <input type="radio" id="option4" name="answer" value="${
                    row_data[index][6]
                  }">
                  <label for="option4" class="ans_font">${
                    row_data[index][6]
                  }</label><br>
                  ${
                    index < row_data.length - 1
                      ? '<button type="button" name="next" onclick="nextQuestion()">Next</button>'
                      : '<button type="button" name="submitQuiz" onclick="submitQuiz()">Submit</button>'
                  }
              `;
  }

  // Function to submit the quiz
  function submitQuiz() {
    calculateTotalScore();
    document.getElementById("quiz-form").submit();
  }
</script>

{% endblock %}
