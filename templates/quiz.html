{% extends 'base.html' %}

{% block title %}Quiz{% endblock %}
{% block style_content %}
<style>
    
</style>
{% endblock %}
{% block left_content %}
   <!-- left block content -->
   <div class="timer" id="timer">No time to Show</div>
   <input type="hidden" name="timer_value" id="timer_value" value="{{timer_value}}">
   <!-- <div  name="countdown" id="countdown" value="{{countdown}}"> {{ countdown }} </div> -->
   
{% endblock %}

{% block middle_content %}
    <!-- Generate quiz -->
    <div class="container" style="height: 500px; width: 600px;">
        <form id="quiz-form" action="/submit/{{ index }}" method="POST">
            {% if row_data %}
                {% if index > 0 %}
                <button type="submit" name="prev">Previous</button>
                {% endif %}
                
                {% if index < row_data|length %}
                    <h2>Question {{ index + 1 }}:</h2>
                    <p id="q_font">{{ row_data[index][2] }}</p> <!-- Display the question -->
                    
                    <!-- Hidden input field to store the correct answer -->
                    <input type="hidden" name="correct_answer" value="{{ row_data[index][7] }}">
                    
                    <input type="radio" id="option1" name="answer" value="{{ row_data[index][3] }}">
                    <label for="option1" class="ans_font">{{ row_data[index][3] }}</label><br> <!-- Display option 1 -->
                    
                    <input type="radio" id="option2" name="answer" value="{{ row_data[index][4] }}">
                    <label for="option2" class="ans_font">{{ row_data[index][4] }}</label><br> <!-- Display option 2 -->
                    
                    <input type="radio" id="option3" name="answer" value="{{ row_data[index][5] }}">
                    <label for="option3" class="ans_font">{{ row_data[index][5] }}</label><br> <!-- Display option 3 -->
                    
                    <input type="radio" id="option4" name="answer" value="{{ row_data[index][6] }}">
                    <label for="option4" class="ans_font">{{ row_data[index][6] }}</label><br> <!-- Display option 4 -->
                    
                    {% if index < row_data|length - 1 %}
                    <button type="submit" name="next">Next</button>
                    {% else %}
                    <button type="submit" name="submit">Submit</button>
                    {% endif %}
                {% else %}
                    <p>No questions available.</p>
                {% endif %}
            {% else %}
                <p>No quiz data available.</p>
            {% endif %}
             <!-- Hidden input field to pass the updated timer value -->
             <input type="hidden" name="timer_value_updated" id="timer_value_hidden" value="{{ timer_value }}">
        </form>
    </div>

    <script>
        // Set the timer duration in seconds
        var timerDuration = parseInt(getElementById('timer_value_hidden').value);// 10 minutes
        console.log(timerDuration);

        // Function to update the countdown timer
        function updateTimer() {
            if (timerDuration >= 0) {
                var minutes = Math.floor(timerDuration / 60);
                var seconds = timerDuration % 60;
                document.getElementById('timer').innerText = minutes.toString().padStart(2, '0') + ':' + seconds.toString().padStart(2, '0');
                // document.getElementById('timer').innerText = timerDuration.toString();
                // document.getElementById('timer_value').value = timerDuration.toString();
                document.getElementById('timer_value_hidden').value = timerDuration.toString();
                timerDuration--; // Decrease timer duration by 1 second
                
                if (timerDuration < 0) {
                    // Submit the quiz when timer reaches 00
                    document.getElementById('quiz-form').submit();
                    clearInterval(timerInterval); // Stop the countdown

                }
            }
        }

        // Update the timer every second
        var timerInterval = setInterval(updateTimer, 1000);
    </script>
{% endblock %}
